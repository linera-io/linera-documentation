<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Debugging</title>


        <!-- Custom HTML head -->

        <meta name="description" content="The Linera Manual">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../../css/variables-d0866e17.css">
        <link rel="stylesheet" href="../../css/general-e9745eeb.css">
        <link rel="stylesheet" href="../../css/chrome-d7ced664.css">
        <link rel="stylesheet" href="../../css/print-ad67d350.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome-799aeb25.css">
        <link rel="stylesheet" href="../../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight-493f70e1.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight-56612340.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/theme-864c5258.css">
        <link rel="stylesheet" href="../.././mdbook-admonish.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc-5a0e1d68.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const html = document.documentElement;
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/linera-io/linera-documentation" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/linera-io/linera-documentation/edit/main/src/operators/testnets/debugging.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="debugging"><a class="header" href="#debugging">Debugging</a></h1>
<p>This section covers potential issues with validator deployments and how to
resolve them.</p>
<h2 id="common-issues"><a class="header" href="#common-issues">Common Issues</a></h2>
<p>Below we outline a few of the common occurrences with Linera validator
deployments and how to resolve them.</p>
<h3 id="shard-init-process-is-stuck"><a class="header" href="#shard-init-process-is-stuck"><code>shard-init</code> process is stuck</a></h3>
<p>The <code>shard-init</code> process is responsible for initializing the database and
shards.</p>
<p>The database inside a validator, ScyllaDB, can take some time to initialize as
it performs performance checks and tunes itself against the underlying
hardware - this should take about 10 minutes.</p>
<p>If the <code>shard-init</code> process is <em>still</em> stuck after that, the issue is usually:</p>
<ol>
<li>Not enough events allowed in async I/O contexts. A resolution is outlined
<a href="requirements.html#scylladb-configuration">here</a>.</li>
<li>Stale volumes from a previous deployment. Docker doesn't clean up volumes
automatically when deleting an old deployment via <code>docker compose down</code> or
even when running <code>docker system prune -a</code>. The old stale volumes need to be
removed explicitly via <code>docker volume rm ...</code>.</li>
</ol>
<p>If neither of these fixes resolves the issue, a closer inspection of the logs is
required.</p>
<h3 id="pull-access-denied"><a class="header" href="#pull-access-denied"><code>pull access denied</code></a></h3>
<p>When deploying a validator, the system uses pre-built Docker images from the
official registry by default. You can also build the Docker image yourself using
the <code>--local-build</code> flag.</p>
<p>The Docker Compose manifest looks for the <code>LINERA_IMAGE</code> environment variable.
If not set, it defaults to:</p>
<pre><code class="language-text">us-docker.pkg.dev/linera-io-dev/linera-public-registry/linera:latest
</code></pre>
<p>If you encounter pull access issues:</p>
<ol>
<li>
<p><strong>Check network connectivity</strong> to the registry:</p>
<pre><code class="language-bash">docker pull us-docker.pkg.dev/linera-io-dev/linera-public-registry/linera:latest
</code></pre>
</li>
<li>
<p><strong>Build locally instead</strong> if registry access fails:</p>
<pre><code class="language-bash">scripts/deploy-validator.sh &lt;host&gt; &lt;email&gt; --local-build
</code></pre>
<p>Or manually:</p>
<pre><code class="language-bash">docker build --build-arg git_commit="$(git rev-parse --short HEAD)" -f docker/Dockerfile . -t linera
export LINERA_IMAGE=linera
</code></pre>
</li>
<li>
<p><strong>Use a custom image</strong> by setting <code>LINERA_IMAGE</code>:</p>
<pre><code class="language-bash">export LINERA_IMAGE=my-registry/my-image:my-tag
</code></pre>
</li>
</ol>
<h3 id="access-denied-to-genesisjson"><a class="header" href="#access-denied-to-genesisjson"><code>Access denied to genesis.json</code></a></h3>
<p>This occurs when the genesis configuration URL is malformed via string
formatting. The deploy script uses the name of the current branch to create the
URL so make sure you have checked out <code>testnet_conway</code>.</p>
<h3 id="ssl-certificate-issues-with-caddy"><a class="header" href="#ssl-certificate-issues-with-caddy">SSL Certificate Issues with Caddy</a></h3>
<p>If Caddy fails to obtain SSL certificates:</p>
<ol>
<li><strong>Check domain DNS</strong>: Ensure your domain points to the server's public IP</li>
<li><strong>Check ports</strong>: Verify ports 80 and 443 are open and reachable:
<pre><code class="language-bash">sudo netstat -tlnp | grep -E ':80|:443'
</code></pre>
</li>
<li><strong>Check Caddy logs</strong>:
<pre><code class="language-bash">docker compose logs web
</code></pre>
</li>
<li><strong>Rate limiting</strong>: Let's Encrypt has rate limits. If hit, wait or use
staging:
<pre><code class="language-bash"># Edit docker/Caddyfile and add to the global section:
acme_ca https://acme-staging-v02.api.letsencrypt.org/directory
</code></pre>
</li>
</ol>
<h3 id="port-conflicts"><a class="header" href="#port-conflicts">Port Conflicts</a></h3>
<p>The validator now uses these ports:</p>
<ul>
<li><strong>80</strong>: HTTP (Caddy for ACME challenge)</li>
<li><strong>443</strong>: HTTPS (Caddy reverse proxy)</li>
<li><strong>3000</strong>: Grafana dashboard</li>
<li><strong>9090</strong>: Prometheus metrics</li>
<li><strong>19100</strong>: Internal proxy port (not exposed externally anymore)</li>
</ul>
<p>If you see port binding errors:</p>
<pre><code class="language-bash"># Check what's using the ports
sudo lsof -i :80
sudo lsof -i :443

# Stop conflicting services or change ports in docker-compose.yml
</code></pre>
<h2 id="support"><a class="header" href="#support">Support</a></h2>
<p>Support and communication with the core team is done via the <code>#validator</code>
private channel in the <a href="https://discord.com/invite/linera">Linera Discord</a>.</p>
<p>If there are any outstanding issues which could not be resolved by consulting
this document, you can reach out there.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../operators/testnets/monitoring-logging.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../appendix/glossary.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../operators/testnets/monitoring-logging.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../appendix/glossary.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../../mark-09e88c2c.min.js"></script>
        <script src="../../searcher-b074573a.js"></script>

        <script src="../../clipboard-1626706a.min.js"></script>
        <script src="../../highlight-abc7f01d.js"></script>
        <script src="../../book-ba43d0c1.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../custom-6e1704cf.js"></script>
        <script src="../../mermaid-eefea253.min.js"></script>
        <script src="../../mermaid-init-4a2716e5.js"></script>


    </div>
    </body>
</html>
