<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Interactivity</title>


        <!-- Custom HTML head -->

        <meta name="description" content="The Linera Manual">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../../css/variables-d0866e17.css">
        <link rel="stylesheet" href="../../css/general-e9745eeb.css">
        <link rel="stylesheet" href="../../css/chrome-d7ced664.css">
        <link rel="stylesheet" href="../../css/print-ad67d350.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome-799aeb25.css">
        <link rel="stylesheet" href="../../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight-493f70e1.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight-56612340.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/theme-864c5258.css">
        <link rel="stylesheet" href="../.././mdbook-admonish.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc-68d988ca.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const html = document.documentElement;
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/linera-io/linera-documentation" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/linera-io/linera-documentation/edit/main/src/developers/frontend/interactivity.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="interacting-with-linera"><a class="header" href="#interacting-with-linera">Interacting with Linera</a></h1>
<p>Add a <code>&lt;script type="module"&gt;</code> to your page. The location of this module doesn't
matter: module scripts are deferred until after page load. This is where we will
write all the JavaScript necessary to interact with Linera.</p>
<h2 id="importing-the-linera-client-library"><a class="header" href="#importing-the-linera-client-library">Importing the Linera client library</a></h2>
<p>To add the Linera client library to your page, put the following import map into
the <code>&lt;head&gt;</code> of your HTML:</p>
<pre><code class="language-html">&lt;script type="importmap"&gt;
  {
    "imports": {
      "@linera/client": "./node_modules/@linera/client/dist/linera_web.js"
    }
  }
&lt;/script&gt;
</code></pre>
<p>Now the module <code>@linera/client</code> is available for import in your module:</p>
<pre><code class="language-html">&lt;script type="module"&gt;
  import * as linera from '@linera/client';
&lt;/script&gt;
</code></pre>
<h2 id="referring-to-the-counter-app"><a class="header" href="#referring-to-the-counter-app">Referring to the counter app</a></h2>
<p>We'll need the application ID of the counter app deployed on our network of
choice. This tutorial uses Testnet Babbage, and the following application ID
refers to a counter app published there:</p>
<pre><code class="language-javascript">const COUNTER_APP_ID =
  '2b1a0df8868206a4b7d6c2fdda911e4355d6c0115b896d4947ef8e535ee3c6b8';
</code></pre>
<p>If you wish to use a different network or deploy your own backend, you may need
to change the application ID. So long as it points to an application satisfying
the counter ABI, the rest of this tutorial will work without modification.</p>
<h2 id="initialization"><a class="header" href="#initialization">Initialization</a></h2>
<p>The first thing we need to do to interact with the Linera client library is
initialize it. This will download the WebAssembly binary, create a new memory
for it, and initialize the memory.</p>
<pre><code class="language-javascript">await linera.default();
</code></pre>
<h2 id="getting-a-wallet"><a class="header" href="#getting-a-wallet">Getting a wallet</a></h2>
<p>If you have a wallet file available, you can use the <code>linera.Wallet.fromJson</code>
function to create a <code>linera.Wallet</code> from it. However, for the purposes of the
tutorial, we will connect to the Testnet Babbage faucet and create a new wallet
with a fresh chain owning some tokens. We will also update our <code>#chain-id</code>
element to let the user know the ID of their new chain.</p>
<pre><code class="language-javascript">const faucet = await new linera.Faucet(
  'https://faucet.testnet-babbage.linera.net',
);
const wallet = await faucet.createWallet();
const client = await new linera.Client(wallet);
document.getElementById('chain-id').innerText = await faucet.claimChain(client);
</code></pre>
<h2 id="communicating-with-the-application"><a class="header" href="#communicating-with-the-application">Communicating with the application</a></h2>
<p>Calling the method <code>client.application(applicationId)</code> will get you an object
representing the application backend.</p>
<pre><code class="language-javascript">const backend = await client.frontend().application(COUNTER_APP_ID);
</code></pre>
<p>You can query the backend application using the <code>query</code> method, which takes an
arbitrary string that will be passed to the backend as a request, and returns a
<code>Promise</code> of the response. We can use this to update our <code>#count</code> element with
the current value of the counter.</p>
<pre><code class="language-javascript">async function updateCount() {
  const response = await backend.query('{ "query": "query { value }" }');
  document.getElementById('count').innerText = JSON.parse(response).data.value;
}

updateCount();
</code></pre>
<p>The counter application uses GraphQL as its request language. By convention,
Linera applications accept GraphQL as strings of JSON in the
<a href="https://www.apollographql.com/docs/apollo-server/v2/requests">Apollo Server POST format</a>,
but your application is free to accept whatever format it wants.</p>
<p>GraphQL <code>query</code> operations can be used to inspect the state of the application,
while <code>mutation</code> operations cause the client to propose new blocks with the
result of the requested modification. Let's attach an event handler to our
button that proposes an increment to the counter value.</p>
<pre><code class="language-javascript">document.getElementById('increment').addEventListener('click', () =&gt; {
  backend.query('{ "query": "mutation { increment(value: 1) }" }');
});
</code></pre>
<h2 id="notifications-and-reactivity"><a class="header" href="#notifications-and-reactivity">Notifications and reactivity</a></h2>
<p>If you click the button, the value of the counter will go up, but the UI element
currently won't change to reflect it. Let's fix that.</p>
<p>The <code>Client</code> object also supports adding a callback for notifications. This is
key to Linera's reactivity: if something happens to one of a client's chains,
this callback will immediately be called with a notification object containing
information about the event.</p>
<p>In this case the only updates we're interested in are new blocks, which imply
that the counter value has changed, so whenever we see a new block let's update
the counter.</p>
<pre><code class="language-javascript">client.onNotification(notification =&gt; {
  if (notification.reason.NewBlock) updateCount();
});
</code></pre>
<p>We're the sole owner of this chain, so the value query is purely local: nobody
could have updated the chain state but us. In the general case, though, other
users on other clients could update the chain with new blocks or by sending it
messages, and we'd get immediately notified in just the same way.</p>
<h2 id="conclusion"><a class="header" href="#conclusion">Conclusion</a></h2>
<p>That's it! In a few lines of code we've implemented an application frontend that
communicates with the Linera testnet and allows bidirectional communication with
an application, including realtime updates when the chain state changes.</p>
<p>A somewhat fleshed-out version of the code from this tutorial can be found in
the <code>examples/hosted-counter</code> subdirectory of the
<a href="https://github.com/linera-io/linera-web"><code>linera-web</code> repository</a>, next to some
more complicated examples. Alternatively, you can
<a href="https://demos.linera.net/hosted/counter">try it out online</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../developers/frontend/setup.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../developers/advanced_topics.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../developers/frontend/setup.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../developers/advanced_topics.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../../mark-09e88c2c.min.js"></script>
        <script src="../../searcher-b074573a.js"></script>

        <script src="../../clipboard-1626706a.min.js"></script>
        <script src="../../highlight-abc7f01d.js"></script>
        <script src="../../book-ba43d0c1.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../custom-6e1704cf.js"></script>
        <script src="../../mermaid-eefea253.min.js"></script>
        <script src="../../mermaid-init-4a2716e5.js"></script>


    </div>
    </body>
</html>
