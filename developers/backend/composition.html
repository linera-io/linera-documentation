<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Calling other Applications</title>


        <!-- Custom HTML head -->

        <meta name="description" content="The Linera Manual">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../../css/variables-d0866e17.css">
        <link rel="stylesheet" href="../../css/general-e9745eeb.css">
        <link rel="stylesheet" href="../../css/chrome-d7ced664.css">
        <link rel="stylesheet" href="../../css/print-ad67d350.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome-799aeb25.css">
        <link rel="stylesheet" href="../../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight-493f70e1.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight-56612340.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/theme-864c5258.css">
        <link rel="stylesheet" href="../.././mdbook-admonish.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc-68d988ca.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const html = document.documentElement;
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/linera-io/linera-documentation" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/linera-io/linera-documentation/edit/main/src/developers/backend/composition.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="calling-other-applications"><a class="header" href="#calling-other-applications">Calling other Applications</a></h1>
<p>We have seen that cross-chain messages sent by an application on one chain are
always handled by the <em>same</em> application on the target chain.</p>
<p>This section is about calling other applications using <em>cross-application
calls</em>.</p>
<p>Such calls happen on the same chain and are made with the helper method
<a href="https://docs.rs/linera-sdk/latest/linera_sdk/contract/type.ContractRuntime.html#call_application"><code>ContractRuntime::call_application</code></a>:</p>
<pre><code class="language-rust ignore">    pub fn call_application&lt;A: ContractAbi + Send&gt;(
        &amp;mut self,
        authenticated: bool,
        application: ApplicationId&lt;A&gt;,
        call: &amp;A::Operation,
    ) -&gt; A::Response</code></pre>
<p>The <code>authenticated</code> argument specifies whether the callee is allowed to perform
actions that require authentication either</p>
<ul>
<li>on behalf of the signer of the original block that caused this call, or</li>
<li>on behalf of the calling application.</li>
</ul>
<p>The <code>application</code> argument is the callee's application ID, and <code>A</code> is the
callee's ABI.</p>
<p>The <code>call</code> argument is the operation requested by the application call.</p>
<h2 id="example-crowd-funding"><a class="header" href="#example-crowd-funding">Example: crowd-funding</a></h2>
<p>The <code>crowd-funding</code> example application allows the application creator to launch
a campaign with a funding target. That target can be an amount specified in any
type of token based on the <code>fungible</code> application. Others can then pledge tokens
of that type to the campaign, and if the target is not reached by the deadline,
they are refunded.</p>
<p>If Alice used the <code>fungible</code> example to create a Pugecoin application (with an
impressionable pug as its mascot), then Bob can create a <code>crowd-funding</code>
application, use Pugecoin's application ID as <code>CrowdFundingAbi::Parameters</code>, and
specify in <code>CrowdFundingAbi::InstantiationArgument</code> that his campaign will run
for one week and has a target of 1000 Pugecoins.</p>
<p>Now let's say Carol wants to pledge 10 Pugecoin tokens to Bob's campaign. She
can make her pledge by running the <code>linera service</code> and making a query to Bob's
application:</p>
<pre><code class="language-json">mutation { pledge(owner: "User:841â€¦6c0", amount: "10") }
</code></pre>
<p>This will add a block to Carol's chain containing the pledge operation that gets
handled by <code>CrowdFunding::execute_operation</code>, resulting in one cross-application
call and two cross-chain messages:</p>
<p>First <code>CrowdFunding::execute_operation</code> calls the <code>fungible</code> application on
Carol's chain to transfer 10 tokens to Carol's account on Bob's chain:</p>
<pre><code class="language-rust ignore">// ...
let call = fungible::Operation::Transfer {
    owner,
    amount,
    target_account,
};
// ...
self.runtime
    .call_application(/* authenticated by owner */ true, fungible_id, &amp;call);</code></pre>
<p>This causes <code>Fungible::execute_operation</code> to be run, which will create a
cross-chain message sending the amount 10 to the Pugecoin application instance
on Bob's chain.</p>
<p>After the cross-application call returns, <code>CrowdFunding::execute_operation</code>
continues to create another cross-chain message
<code>crowd_funding::Message::PledgeWithAccount</code>, which informs the crowd-funding
application on Bob's chain that the 10 tokens are meant for the campaign.</p>
<p>When Bob now adds a block to his chain that handles the two incoming messages,
first <code>Fungible::execute_message</code> gets executed, and then
<code>CrowdFunding::execute_message</code>. The latter makes another cross-application call
to transfer the 10 tokens from Carol's account to the crowd-funding
application's account (both on Bob's chain). That is successful because Carol
does now have 10 tokens on this chain and she authenticated the transfer
indirectly by signing her block. The crowd-funding application now makes a note
in its application state on Bob's chain that Carol has pledged 10 Pugecoin
tokens.</p>
<h1 id="references"><a class="header" href="#references">References</a></h1>
<p>For the complete code, please take a look at the
<a href="https://github.com/linera-io/linera-protocol/blob/300ba6d6a015d93a837296004e5958f843452248/examples/crowd-funding/src/contract.rs"><code>crowd-funding</code></a>
and the
<a href="https://github.com/linera-io/linera-protocol/blob/300ba6d6a015d93a837296004e5958f843452248/examples/fungible/src/contract.rs"><code>fungible</code></a>
application contracts in the <code>examples</code> folder in <code>linera-protocol</code>.</p>
<p>The implementation of the Runtime made available to contracts is defined in
<a href="https://github.com/linera-io/linera-protocol/blob/300ba6d6a015d93a837296004e5958f843452248/linera-sdk/src/contract/runtime.rs">this file</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../developers/backend/messages.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../developers/backend/blobs.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../developers/backend/messages.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../developers/backend/blobs.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../../mark-09e88c2c.min.js"></script>
        <script src="../../searcher-b074573a.js"></script>

        <script src="../../clipboard-1626706a.min.js"></script>
        <script src="../../highlight-abc7f01d.js"></script>
        <script src="../../book-ba43d0c1.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../custom-6e1704cf.js"></script>
        <script src="../../mermaid-eefea253.min.js"></script>
        <script src="../../mermaid-init-4a2716e5.js"></script>


    </div>
    </body>
</html>
